<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Manage Groups</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#f9f9f9; margin:0; padding:20px; }
    .container { max-width:1000px; margin:auto; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
    h2 { text-align:center; color:#333; }
    input, select, textarea {
      width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:8px;
    }
    button {
      padding:8px 12px; background:#007bff; color:white; border:none; border-radius:6px; cursor:pointer;
    }
    button:hover { background:#0056b3; }
    .logout { background:#dc3545; margin-top:15px; float:right; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    table, th, td { border:1px solid #ccc; }
    th, td { padding:10px; text-align:left; }
    th { background:#f1f1f1; }
    .actions button { margin-right:5px; }
  </style>
</head>
<body>

<div class="container">
  <button class="logout" onclick="logout()">Logout</button>
  <h2>📌 Admin Panel - Manage Groups</h2>

  <!-- Add Group Form -->
  <form id="groupForm">
    <input type="text" id="name" placeholder="Group Name" required>
    <input type="url" id="link" placeholder="Group Link (WhatsApp/Telegram)" required>

    <label>Group Type</label>
    <select id="groupType" required>
      <option value="">-- Select --</option>
      <option value="Cricket">🏏 Cricket</option>
      <option value="Football">⚽ Football</option>
      <option value="Tennis">🎾 Tennis</option>
      <option value="Ludo">🎲 Ludo</option>
      <option value="Other">📌 Other</option>
    </select>

    <label>Platforms</label><br>
    <input type="checkbox" class="platform" value="WhatsApp"> WhatsApp
    <input type="checkbox" class="platform" value="Telegram"> Telegram
    <input type="checkbox" class="platform" value="Facebook"> Facebook
    <input type="checkbox" class="platform" value="Other"> Other
    <br><br>

    <textarea id="description" placeholder="Short Description"></textarea>
    <button type="submit" id="submitBtn">Submit Group</button>
  </form>

  <!-- Groups List -->
  <h3>📋 Groups List</h3>
  <table>
    <thead>
      <tr>
        <th>📛 Name</th>
        <th>🔗 Link</th>
        <th>🏷 Type</th>
        <th>📱 Platforms</th>
        <th>📝 Description</th>
        <th>⚙️ Actions</th>
      </tr>
    </thead>
    <tbody id="groupsTable"></tbody>
  </table>
</div>

<script>
  // Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCwdlnLXcXauh3_YmY6cwswqzcieMOHI0Y",
    authDomain: "ludogroup-a530a.firebaseapp.com",
    projectId: "ludogroup-a530a",
    storageBucket: "ludogroup-a530a.appspot.com",
    messagingSenderId: "838421084676",
    appId: "1:838421084676:web:9e02670e280eafcd86d351"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();
  const db = firebase.firestore();

  // ✅ Protect Page
  auth.onAuthStateChanged(user => {
    if (!user) {
      window.location.href = "privacy.html";
    }
  });

  // 🔓 Logout
  function logout() {
    auth.signOut().then(() => {
      window.location.href = "privacy.html";
    });
  }

  // 📌 Add Group
  document.getElementById("groupForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const name = document.getElementById("name").value.trim();
    const link = document.getElementById("link").value.trim();
    const groupType = document.getElementById("groupType").value;
    const description = document.getElementById("description").value.trim();
    const platforms = Array.from(document.querySelectorAll(".platform:checked")).map(cb => cb.value);

    if (!name || !link || !groupType || platforms.length === 0) {
      alert("⚠️ Please fill all required fields");
      return;
    }

    try {
      document.getElementById("submitBtn").innerText = "Submitting...";

      await db.collection("Groups").add({
        name,
        link,
        type: groupType,
        platforms,
        description,
        status: "active",
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      alert("✅ Group added successfully!");
      document.getElementById("groupForm").reset();
      document.getElementById("submitBtn").innerText = "Submit Group";

    } catch (error) {
      alert("❌ Error: " + error.message);
      document.getElementById("submitBtn").innerText = "Submit Group";
    }
  });

  // 📋 Fetch Groups List
  const groupsTable = document.getElementById("groupsTable");

  function renderGroups() {
    db.collection("Groups").orderBy("timestamp", "desc").onSnapshot(snapshot => {
      groupsTable.innerHTML = "";
      snapshot.forEach(doc => {
        const g = doc.data();
        const row = `
          <tr>
            <td>${g.name}</td>
            <td><a href="${g.link}" target="_blank">Open Link</a></td>
            <td>${g.type}</td>
            <td>${g.platforms ? g.platforms.join(", ") : ""}</td>
            <td>${g.description || ""}</td>
            <td class="actions">
              <button onclick="editGroup('${doc.id}', '${g.name}', '${g.link}', '${g.type}', '${(g.platforms || []).join(",")}', '${g.description || ""}')">✏️ Edit</button>
              <button onclick="deleteGroup('${doc.id}')">🗑️ Delete</button>
            </td>
          </tr>
        `;
        groupsTable.innerHTML += row;
      });
    });
  }
  renderGroups();

  // ✏️ Edit Group
  function editGroup(id, name, link, type, platforms, description) {
    document.getElementById("name").value = name;
    document.getElementById("link").value = link;
    document.getElementById("groupType").value = type;
    document.getElementById("description").value = description;

    document.querySelectorAll(".platform").forEach(cb => {
      cb.checked = platforms.includes(cb.value);
    });

    document.getElementById("submitBtn").innerText = "Update Group";
    document.getElementById("groupForm").onsubmit = async (e) => {
      e.preventDefault();
      const newName = document.getElementById("name").value.trim();
      const newLink = document.getElementById("link").value.trim();
      const newType = document.getElementById("groupType").value;
      const newDesc = document.getElementById("description").value.trim();
      const newPlatforms = Array.from(document.querySelectorAll(".platform:checked")).map(cb => cb.value);

      await db.collection("Groups").doc(id).update({
        name: newName,
        link: newLink,
        type: newType,
        description: newDesc,
        platforms: newPlatforms
      });

      alert("✅ Group updated!");
      document.getElementById("groupForm").reset();
      document.getElementById("submitBtn").innerText = "Submit Group";
      document.getElementById("groupForm").onsubmit = null;
    };
  }

  // 🗑️ Delete Group
  async function deleteGroup(id) {
    if (confirm("⚠️ Are you sure you want to delete this group?")) {
      await db.collection("Groups").doc(id).delete();
      alert("🗑️ Group deleted");
    }
  }
</script>

</body>
</html>
