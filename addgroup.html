<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Add Ludo Group - JokerLudo</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="Join verified Ludo WhatsApp group links on Joker Ludo. Play Ludo King, Ludo Star, Yalla Ludo and earn real money daily." />
  <meta name="keywords" content="Ludo WhatsApp group, Ludo King, earn money Ludo, Ludo betting" />
  <meta name="author" content="JokerLudo Group" />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#ffcc00" />

  <!-- Firebase SDKs (LOAD FIRST) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
      color: #333;
    }
    
    /* Your existing CSS styles... */
    .connection-status {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 15px;
      border-radius: 5px;
      z-index: 1000;
      font-size: 14px;
    }
    
    .connection-status .connected {
      color: #28a745;
      background: #e8f5e9;
      padding: 8px 12px;
      border-radius: 4px;
    }
    
    .connection-status .disconnected {
      color: #dc3545;
      background: #f8d7da;
      padding: 8px 12px;
      border-radius: 4px;
    }
    
    /* Rest of your existing CSS... */
  </style>
</head>
<body>

  <nav class="navbar">
    <a href="index.html" class="logo">ðŸŽ² JokerLudo Group</a>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="rules.html">Rules</a>
      <a href="join.html">Join</a>
      <a href="addgroup.html">Add Group</a>
      <a href="contact.html">Contact</a>
      <a href="privacy.html">Privacy</a>
    </div>
  </nav>

  <div class="container">
    <h1>Add Your Ludo Group</h1>
    <div class="note">
      ðŸ“¢ <strong>Note:</strong> All group submissions are free. Groups will be published after admin approval.
    </div>

    <form id="groupForm">
      <div class="form-group">
        <label for="name">Group Name*</label>
        <input type="text" id="name" placeholder="Enter your group name" required>
      </div>

      <div class="form-group">
        <label for="link">Group Link*</label>
        <input type="url" id="link" placeholder="https://chat.whatsapp.com/yourgroup" required>
      </div>

      <div class="form-group">
        <label for="groupType">Group Type*</label>
        <select id="groupType" required>
          <option value="">Select Group Type</option>
          <option value="Gaming">Gaming</option>
          <option value="Earning">Earning Money</option>
        </select>
      </div>

      <div class="form-group">
        <label>Platforms*</label>
        <div class="platforms">
          <label><input type="checkbox" class="platform" value="WhatsApp" checked> WhatsApp</label>
          <label><input type="checkbox" class="platform" value="Telegram"> Telegram</label>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Group Description</label>
        <textarea id="description" rows="4" placeholder="Tell us about your group"></textarea>
      </div>

      <button type="submit" class="submit-button">Submit Group</button>
    </form>
  </div>

  <footer>
    <div class="footer-links">
      <a href="index.html">Home</a>
      <a href="privacy.html">Privacy</a>
    </div>
    <p>Â© 2025 JokerLudo Group. All Rights Reserved.</p>
  </footer>

  <!-- Firebase Initialization -->
  <script>
    // Initialize Firebase immediately when scripts load
    const firebaseConfig = {
      apiKey: "AIzaSyCwdlnLXcXauh3_YmY6cwswqzcieMOHI0Y",
      authDomain: "ludogroup-a530a.firebaseapp.com",
      projectId: "ludogroup-a530a",
      storageBucket: "ludogroup-a530a.appspot.com",
      messagingSenderId: "838421084676",
      appId: "1:838421084676:web:9e02670e280eafcd86d351"
    };

    // Initialize Firebase if not already initialized
    if (typeof firebase !== 'undefined') {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      } else {
        firebase.app(); // if already initialized, use that instance
      }
    }

    // Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', () => {
      // Check if Firebase initialized properly
      if (typeof firebase === 'undefined' || !firebase.apps.length) {
        console.error('Firebase failed to initialize!');
        alert('System error: Please refresh the page');
        return;
      }

      const db = firebase.firestore();
      
      // Create connection status element
      const connectionStatus = document.createElement('div');
      connectionStatus.className = 'connection-status';
      document.body.appendChild(connectionStatus);

      // Test database connection
      async function testConnection() {
        try {
          await db.collection("Groups").limit(1).get();
          connectionStatus.innerHTML = '<span class="connected">âœ“ Connected to database</span>';
          return true;
        } catch (err) {
          console.error("Connection failed:", err);
          connectionStatus.innerHTML = '<span class="disconnected">âš  Database connection failed</span>';
          return false;
        }
      }

      // Handle form submission
      const form = document.getElementById('groupForm');
      if (!form) {
        console.error("Form not found");
        return;
      }

      testConnection().then(isConnected => {
        if (!isConnected) {
          form.addEventListener('submit', e => {
            e.preventDefault();
            alert('Database connection failed. Please try again later.');
          });
          return;
        }

        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          // Get form values
          const name = document.getElementById("name").value.trim();
          const link = document.getElementById("link").value.trim();
          const groupType = document.getElementById("groupType").value;
          const platforms = Array.from(document.querySelectorAll(".platform:checked")).map(cb => cb.value);

          // Validate
          if (!name || !link || !groupType || platforms.length === 0) {
            alert("Please fill all required fields");
            return;
          }

          const submitBtn = document.querySelector('.submit-button');
          try {
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            // Save to Firestore
            await db.collection("Groups").add({
              name,
              link,
              type: groupType,
              platforms,
              status: "pending",
              timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            // Success
            submitBtn.textContent = 'Submitted!';
            setTimeout(() => {
              submitBtn.textContent = 'Submit Group';
              submitBtn.disabled = false;
              form.reset();
            }, 2000);

            // Optional: Send WhatsApp notification
            const phone = "9473746020";
            const message = `New Group: ${name} (${groupType}) - ${link}`;
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');

          } catch (err) {
            console.error("Submission error:", err);
            alert("Submission failed. Please try again.");
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Group';
          }
        });
      });
    });
  </script>
</body>
</html>
